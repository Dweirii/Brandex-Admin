generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Store {
  id               String             @id @default(uuid())
  name             String
  userId           String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  billboards       Billboard[]
  categories       Category[]
  orders           Order[]
  ProductImportLog ProductImportLog[]
  products         Product[]
}

model Category {
  id          String    @id @default(uuid())
  storeId     String
  billboardId String
  name        String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  billboard   Billboard @relation(fields: [billboardId], references: [id])
  store       Store     @relation(fields: [storeId], references: [id])
  products    Product[]
}

model Billboard {
  id         String     @id @default(uuid())
  storeId    String
  label      String
  imageUrl   String
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  store      Store      @relation(fields: [storeId], references: [id])
  categories Category[]
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model Product {
  id          String      @id @default(uuid())
  storeId     String
  categoryId  String
  name        String
  description String?
  price       Decimal
  downloadUrl String?
  downloadsCount  Int  @default(0)
  videoUrl    String?
  keywords    String[]    @default([])
  isFeatured  Boolean     @default(false)
  isArchived  Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  Image       Image[]
  OrderItem   OrderItem[]
  category    Category    @relation(fields: [categoryId], references: [id])
  store       Store       @relation(fields: [storeId], references: [id], onDelete: Cascade)

  @@unique([storeId, name], name: "storeId_name")
  @@index([storeId])
  @@index([categoryId])
  @@index([isFeatured])
  @@index([isArchived])
  @@index([createdAt])
  @@map("products")
}

model ProductImportLog {
  id               String       @id @default(uuid())
  storeId          String
  userId           String
  fileName         String
  keywords         String[]     @default([])
  fileSize         Int          @default(0)
  totalRows        Int
  processedRows    Int?         @default(0)
  failedRows       Int?         @default(0)
  status           ImportStatus @default(PROCESSING)
  errorMessage     String?
  processingTimeMs Int?
  createdAt        DateTime     @default(now())
  startedAt        DateTime?
  completedAt      DateTime?
  metadata         Json?
  store            Store        @relation(fields: [storeId], references: [id], onDelete: Cascade)

  @@index([storeId])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("product_import_logs")
}

model Image {
  id        String   @id @default(uuid())
  productId String
  url       String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model Order {
  id               String      @id @default(uuid())
  userId           String?
  storeId          String
  isPaid           Boolean     @default(false)
  email            String?
  price            Decimal?    @default(0.00)
  phone            String?
  address          String?
  paymentProvider  String?
  transactionId    String?     
  sessionId        String?     @default("")
  sessionVerified  Boolean     @default(false)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  store            Store       @relation(fields: [storeId], references: [id])
  orderItems       OrderItem[]
}

model OrderItem {
  id        String   @id @default(uuid())
  orderId   String
  productId String
  price     Decimal? @default(0.00)
  order     Order    @relation(fields: [orderId], references: [id])
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}

enum ImportStatus {
  PROCESSING
  COMPLETED
  COMPLETED_WITH_ERRORS
  FAILED
  CANCELLED
}
