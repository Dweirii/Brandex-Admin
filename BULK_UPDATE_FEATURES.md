# ميزات تحديث المنتجات بالجملة وإدارة الأخطاء

## نظرة عامة

تم إضافة ميزات جديدة لإدارة المنتجات بشكل أكثر كفاءة:

1. **تحديث الأسعار بالجملة** - تحديث أسعار منتجات متعددة دفعة واحدة
2. **إدارة أخطاء استيراد CSV** - معالجة الأخطاء في ملفات CSV مع إمكانية التحرير المباشر
3. **دعم السعر الصفر** - السماح بإنشاء منتجات مجانية

## الميزات الجديدة

### 1. تحديث الأسعار بالجملة

#### الموقع
- صفحة المنتجات → زر "Bulk Price Update"

#### الميزات
- **تحديد متعدد**: تحديد منتجات متعددة للتحديث
- **إجراءات بالجملة**:
  - تعيين سعر محدد
  - إضافة قيمة للسعر الحالي
  - طرح قيمة من السعر الحالي
  - ضرب السعر في قيمة
  - تغيير السعر بنسبة مئوية
- **تحرير فردي**: تحرير سعر كل منتج على حدة
- **معاينة التغييرات**: عرض التغييرات قبل الحفظ
- **حفظ بالجملة**: حفظ جميع التغييرات دفعة واحدة

#### الاستخدام
1. انقر على "Bulk Price Update" في صفحة المنتجات
2. حدد المنتجات المراد تحديثها
3. اختر إجراء بالجملة أو حرر كل منتج على حدة
4. راجع التغييرات
5. احفظ التغييرات

### 2. إدارة أخطاء استيراد CSV

#### الموقع
- صفحة CSV Import → تظهر تلقائياً عند وجود أخطاء

#### الميزات
- **عرض الأخطاء**: عرض جميع الأخطاء في جدول منظم
- **تحرير مباشر**: تصحيح الأخطاء مباشرة في الواجهة
- **تبويبات منفصلة**: 
  - تبويب الأخطاء: عرض الصفوف التي بها أخطاء
  - تبويب الصفوف المصححة: عرض الصفوف الجاهزة للاستيراد
- **إعادة التحقق**: التحقق من صحة الصفوف بعد التحرير
- **استيراد انتقائي**: استيراد الصفوف المصححة فقط
- **تصدير الأخطاء**: تصدير الصفوف التي بها أخطاء كملف CSV

#### الاستخدام
1. ارفع ملف CSV
2. إذا كانت هناك أخطاء، ستظهر واجهة إدارة الأخطاء
3. حرر الصفوف التي بها أخطاء
4. انتقل إلى تبويب "Fixed" لمراجعة الصفوف المصححة
5. استورد الصفوف المصححة

### 3. دعم السعر الصفر

#### التغييرات
- **مخطط التحقق**: تحديث مخطط التحقق لقبول السعر الصفر
- **واجهة المستخدم**: تحديث نماذج إدخال السعر
- **API**: تحديث نقاط النهاية لقبول السعر الصفر
- **قاعدة البيانات**: دعم السعر الصفر في قاعدة البيانات

#### الاستخدام
- يمكن الآن إدخال "0" كسعر للمنتجات المجانية
- يعمل في جميع واجهات إدارة المنتجات
- يعمل في استيراد CSV وتحديث الأسعار بالجملة

## التحسينات التقنية

### التحقق من صحة البيانات
- تحديث مخططات Zod لقبول السعر الصفر
- تحسين رسائل الخطأ
- دعم التحقق المباشر في الواجهة

### واجهة المستخدم
- تصميم متجاوب ومتاح
- رسائل تأكيد واضحة
- مؤشرات التحميل
- معالجة الأخطاء المحسنة

### الأداء
- تحديثات بالجملة لقاعدة البيانات
- معالجة غير متزامنة للملفات الكبيرة
- تحسين استعلامات قاعدة البيانات

## ملفات التحديث

### المكونات الجديدة
- `components/bulk-price-update.tsx` - مكون تحديث الأسعار بالجملة
- `components/csv-import/error-management.tsx` - مكون إدارة الأخطاء

### الملفات المحدثة
- `lib/validation/product-import-schema.ts` - دعم السعر الصفر
- `actions/import-products.ts` - دعم السعر الصفر
- `app/(dashboard)/[storeId]/(routes)/products/[productId]/_components/Product-form.tsx` - دعم السعر الصفر
- `components/csv-import/csv-import-page.tsx` - إضافة إدارة الأخطاء
- `app/(dashboard)/[storeId]/(routes)/products/_components/client.tsx` - إضافة زر تحديث الأسعار بالجملة
- `app/api/[storeId]/products/[productId]/route.ts` - API لتحديث المنتجات

## متطلبات النظام

- Next.js 14+
- React 18+
- Prisma
- Zod للتحقق من صحة البيانات
- Lucide React للأيقونات

## الأمان

- التحقق من صحة البيانات على الخادم
- التحقق من صلاحيات المستخدم
- حماية من هجمات CSRF
- التحقق من ملكية المتجر

## الاختبار

يجب اختبار الميزات التالية:
1. تحديث أسعار متعددة بالجملة
2. استيراد CSV مع أخطاء
3. تصحيح الأخطاء في الواجهة
4. إنشاء منتجات بسعر صفر
5. تصدير الصفوف التي بها أخطاء
6. الأداء مع ملفات كبيرة 